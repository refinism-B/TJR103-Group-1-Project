六都行政區寵物便利度（10 分）計算公式:

一、每一間店（單一店家分數0-1)
google 評分星等
有多少評論
營業時間（以週為單位來看）

計算邏輯：
1.星等評分 / 5 (google最高星等）,會變為 0 ~ 1
 Ex: 4.5 / 5 = 0.9

2.評論數量 和 標準評論數相比 以及基準星等比（全區平均星等）
（標準評論數 依該行政區人口大小 以及 該區評論中位數做調整）
 	
	a.評論數比標準評論數多 =  該店星等值得信任 
	b.評論數比標準評論數少 = 該店星等信任都存疑

標準評論數為m = 30×(人口/10,000)1/3 
30 = 起始基準（統計學上的常見門檻、Google review 的直覺量級）
(人口/10,000)^(1/3) = 動態調整（人口愈多，需要的評論愈多，但不要線性增加）

3.營業時間：
	a.每週 小於 84 小時 = 0.7分
	b.每週 84 小時（=每天 12 小時）當作基準 = 0.8分
	c.超過 84 小時  = 0.9分
	d.如果 24 小時（168 小時）= 1分	
	e.最多不超過１(封頂）

公式： （(店家星等 ÷ 5) × (評論數 ÷ (評論數 + m))  
+ (基準星等比) × (m ÷ (評論數 + m)) ）* 營業時間分數


？二、把同一類的店加總（行政區類別分數）
*這個部分的總分不具意義,要在第三部標準化後才有直觀的比較意義
因為每區規模差很多

待討論的點：是否要把人口放進來看,或是只看寵物數
如果只看「寵物數」
意義：每隻寵物能分到多少資源
好處：完全對應「寵物需求」，直觀好解釋
缺點：若資料不準確（有些區統計不到完整寵物數），分數會偏差
適合：以飼主和寵物生活便利度為核心的專題
如果加「人口」也算
意義：資源分配公平度（資源要分給整個社區，不管有沒有養寵物）
好處：在公共政策、都市規劃討論時比較合理（因為市府要考慮全體居民）
缺點：會稀釋寵物實際需求，和「養寵物的便利性」這個題目不吻合
適合：如果想站在「政府規劃/城市資源」角度來寫報告


該行政區的人，平均能分到多少資源：
把相同類別的所以店家分數加總 （有多少資源,店多代表供給大，店分高代表品質好, 要同時計算）
再除以 該行政區人口 有 幾個一萬人 ＝以每萬人做為單位
3.   再除以「寵物數 ÷ 10,000」= 每萬隻寵物可分到多少 （因為有些城市人口多但寵物不多，有些則相反）
Ex:
	-人口有100,000,寵物20,000
	-24h醫院有2間, 店家分數分別為：0.81, 0.85 —>總和為：1.66
	-人口 = 10個一萬人,寵物 = 2個一萬隻
	-行政區 24h醫院分數 = 1.66 / 10 / 2 *10 = 0.83
這區「每 1 萬人 每萬隻寵物」平均 0.83 的 24h 醫院便利度


－如果只看人口或是只看寵物數 公式： √1.66(分數總和） / 每萬隻寵物數（每萬人口數）=該區該類別便利度分數

平方根是因為大量級的區會被壓縮（避免暴衝），少量區不會被完全淹沒

＊分數差異會依據行政區落差過大,所以這裡的便利度分數難以比較
要做後續的標準化（可以看作其中的一步驟）



？？三、 做標準化（讓分數能比較）
因為六都人口差距大，所以要「縮放」到 0～1 區間。 做法：
-找出六都裡這類別的最高分和最低分
-把每區分數轉成 0～1 的比例（最低=0，最高=1，中間線性分布）
Before
—————








After
想法
不用最小/最大，用 Pr10–Pr90當有效範圍 (Pr10 = 前 10% 小的數值,全體行政區第 10 百分位數 Pr90 = 前 10% 大的數值,全體行政區第 90 百分位數)
超出範圍就截斷，但保留地板與天花板，避免 0 分或滿分
這樣最弱不會是 0，最強也不會直接 10 

保底分數=0.05（保底 0.5 分）、
最高分數=0.90（0.5～9.5 可分配） 
標準化公式：
標準化分數 = 0.5（保底分數） + ( (該區該類別原始分數（第二項算式） − P10) ÷ (P90 − P10) ) × 9（最高分數）

解釋：
本區原始分數 − P10 → 看這個區比「10% 最爛的區」好多少。 （如果比 P10 還爛，就當 0）
÷ (P90 − P10) → 把分數拉到「P10～P90」的比例區間（0～1之間）。
× 9 → 把這個比例放大成「最多可以拿 9 分」。
+ 0.5 → 不管再爛也給保底 0.5 分；就算再好，最多 9.5 分。

EX:

台北「24h 寵物醫院分數」： 北投 = 0.1、信義 = 0.5、大安 = 1.2、中山 = 1.6、文山 = 2.3、板橋 = 3.0

排序後： [0.1, 0.5, 1.2, 1.6, 2.3, 3.0]

算位置：
P10 位置 = (n+1) × 0.10
P90 位置 = (n+1) × 0.90 （n = 總數，這裡 n=6）

→ P10 位置 = 7 × 0.10 = 0.7 → P90 位置 = 7 × 0.90 = 6.3

插值：
P10 位置在第 0.7 → 介於第 1 個(0.1) 和 0 → 取 0.1（因為接近第一筆）。
P90 位置在第 6.3 → 介於第 6 個(3.0) 和第 7 個(不存在) → 取 3.0。
算出 P10 = 0.3，P90 = 2.5






拿北投來算:

(x-P10)/(P90-P10) = (0.1-0.3)/(2.5-0.3) = -0.2/2.2 ≈ -0.09
clip(-0.09,0,1) = 0
Norm = 10 × (0.05 + 0.90×0) = 0.5 分

拿板橋來算：
(x-P10)/(P90-P10) = (3.0-0.3)/(2.5-0.3) = 2.7/2.2 ≈ 1.23
clip(1.23,0,1) = 1
Norm = 10 × (0.05 + 0.90×1) = 9.5 分
所以最爛不會 0，最好也不會滿分 10，兩端保留彈性。



Step1:先算出市內標準化(台北市內行政區比較）

市標準化公式：
標準化分數 = 0.5（保底分數） + ( (該區該類別原始分數（第二項算式） − P10) ÷ (P90 − P10) ) × 9（最高分數）

-Pr10 = 前 10% 小的數值,該市全體行政區第 10 百分位數 -Pr90 = 前 10% 大的數值,該市全體行政區第 90 百分位數

Step2:
在算出六都標準化 （ 各市行政區來比較,台北市大安區跟新北市板橋區比較）

六都標準化公式：

標準化分數 = 0.5（保底分數） + ( (該區該類別原始分數（第二項算式） − P10) ÷ (P90 − P10) ) × 9（最高分數）

-Pr10 = 前 10% 小的數值,全六都裡全體行政區第 10 百分位數 -Pr90 = 前 10% 大的數值,全六都裡該市全體行政區第 90 百分位數


四、加權平均（各類重要性不同）
最後，把七大類（含收容所）合併，加權求總分，滿分 10。
權重（加總 = 1）：
一般寵物醫院：0.27
24h 醫院：0.22
寵物公園：0.17
寵物用品店：0.11
寵物旅館：0.09
寵物餐廳：0.09
收容所：0.05
總分 =10 × (0.27×一般醫院 + 0.22×24h醫院 + 0.17×公園
     + 0.11×用品店 + 0.09×旅館 + 0.09×餐廳 + 0.05×收容所)


解讀流程
先算出每家店好不好用（星等、評論數、營業時間）。
把同一類的店加總，看「這區每一萬人能分到多少資源」。
再把六都的數字壓到 0～1，公平比較。
最後依照「就醫最重要、餐廳次要、收容所一點點」加權，得到總分 0～10。

Before

—————————————-
After


如果要把行政區人口以及行政區寵物數這因素也加進最後呈現的總分裡


先做「市內標準化」，再跟全六都比
做兩種分數：
市內分（In-City 0–10）：在同一個直轄市內，把各行政區拿來比。 在台北市裡，這區算前段班嗎?
全六都分（Cross-Metro 0–10）：全六都一起比。 全六都，這區也還是強嗎?
最後總分（還是 0–10）：    最終分 = 0.7 × 市內分(0.3×一般醫院 + 0.22×24h醫院 + 0.1×公園
     + 0.15×用品店 + 0.09×旅館 + 0.09×餐廳 + 0.05×收容所)
 + 0.3 × 全六都分(0.3×一般醫院 + 0.22×24h醫院 + 0.1×公園
     + 0.15×用品店 + 0.09×旅館 + 0.09×餐廳 + 0.05×收容所)   70% 看市內公平競爭、30% 再看跨城含金量，兼顧公平與可比性。 