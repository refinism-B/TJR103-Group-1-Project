Step 1｜每家店先打分（0–1）
看三件事：星等、評論、營業時間。
標準評論數 m（動態） 1.
m = 30 × (人口 ÷ 10,000)^(1/3) （人口多→門檻較高，但用三次方根，增加不會太暴力）

單店分（0–1）

2.(貝葉斯式平滑 + 可用性乘數）
單店分 = [ (店家星等 ÷ 5) × (評論數 ÷ (評論數 + m))
         + (全區平均星等 ÷ 5) × (m ÷ (評論數 + m)) ]
       × 營業時間分數
 3.營業時間分數（0–1）： 營業時間分數 = 0.6 + (實際時數/168) × 0.4



＊： 星等（好不好） × 評論可信度（能不能信） × 營業時間（方不方便 評論少就多靠「全區平均星等」，以免被極端值騙。


Step 2｜
把同一類店加總，再「除以每萬隻寵物」
先把該類店的單店分全部加起來（量 × 質一起算），再看要分給多少寵物：

類別原始分 = (該類所有單店分的總和) ÷ (寵物數 /10,000)
這個數字還不能直接拿來比（各區規模差太多），要進入下一步標準化。

Step 3｜標準化成 0.5～9.5（公平衡量尺）

用 P10–P90 當「有效範圍」，避免最小/最大極端值扯歪尺規： 
百分位數（P10 / P90）計算法:


1.排序後序列 x(1) ≤ ... ≤ x(n)
2.位置計算：h = 1 + (n-1)p，j = floor(h)，g = h-j
3.百分位數 = x(j) + g*(x(j+1) - x(j))，若 j=n 則取 x(n)

Ex：
台北「24h 寵物醫院分數」： 北投 = 0.1、信義 = 0.5、大安 = 1.2、中山 = 1.6、文山 = 2.3、板橋 = 3.0

排序後： [0.1, 0.5, 1.2, 1.6, 2.3, 3.0]，n=6
P10：h=1+(6-1)0.1=1.5 → 落在第1與第2之間 → 
x(j) + g*(x(j+1) - x(j))=0.1+0.5(0.5-0.1)=0.3。
用白話說
j = 哪一個位置的數字（往下取整數，定位點）
g = 站在這個位置後面「走了多少比例」（小數，代表要往下一個數字靠近多少）

P90：h=1+(6-1)0.9=5.5 → 落在第5與第6之間 → 2.3+0.5(3.0-2.3)=2.65。



標準化分公式（0.5~9.5）：
保底分數=0.5（保底 0.5 分）、
最高分數=9.5（0.5～9.5 可分配） 
標準化分 = 0.5 + min(max((原始分 − P10) ÷ (P90 − P10), 0), 1) × 9

1. (原始分 − P10) ÷ (P90 − P10)
這段是把「原始分」映射到 0～1 的比例。
當原始分 = P10 → 比例 = 0
當原始分 = P90 → 比例 = 1
介於兩者之間就會落在 0～1 之間。

2. max(..., 0)
如果「原始分」比 P10 還小，分子就會是負的，比例 <0。
用 max(..., 0) 把它拉到最小 0，避免出現負值。 → 意思是「比 P10 更差的，直接當作 0」。

3. min(..., 1)
如果「原始分」比 P90 還大，比例就會 >1。
用 min(..., 1) 把它限制在最大 1。 → 意思是「比 P90 更好的，直接當作 1」。

4. 0.5 + (…) × 9
前面的比例現在已經被限制在 0～1 之間。
乘上 9 → 把範圍放大到 0～9。
再加上 0.5 → 整個範圍變成 0.5～9.5。
也就是說：
最差（低於 P10）= 0.5
中間 = 0.5 + (比例×9)
最好（高於 P90）= 9.5

Ex:
逐一代入計算：
北投 0.1：((0.1−0.3) ÷ (2.65−0.3)) = −0.085 → max(...,0)=0 → 0.5+0×9=0.5
信義 0.5：((0.5−0.3) ÷ (2.65−0.3))=0.085 → 0.5+0.085×9=1.27
大安 1.2：((1.2−0.3) ÷ 2.35)=0.383 → 0.5+0.383×9=3.95
中山 1.6：((1.6−0.3) ÷ 2.35)=0.553 → 0.5+0.553×9=5.48
文山 2.3：((2.3−0.3) ÷ 2.35)=0.851 → 0.5+0.851×9=8.16
板橋 3.0：((3.0−0.3) ÷ 2.35)=1.15 → min(...,1)=1 → 0.5+1×9=9.5

最終標準化分數： 北投=0.5、信義=1.27、大安=3.95、中山=5.48、文山=8.16、板橋=9.5


市內標準化：同一城市內各行政區互相比 → 得「市內分(0–10)」
六都標準化：六都所有行政區一起比 → 得「六都分(0–10)」
＊： 市內分數 & 六都分數的母體要分開計算 P10/P90（市內跟六都內是不同的P值）
→ 市內用「市內行政區」的分布，六都用「六都所有行政區」的分布。 把分數映到 P10～P90 這段；最差不會是 0（保底 0.5 分），最好也不會立刻 10（最高 9.5 分）。


Step 4
最終便利度分數

先看市內表現（佔 70%）
把這個行政區在「自己市裡」的各類別分數拿來加權：
一般醫院 × 26%
24h 醫院 × 20%
公園 × 8%
用品店 × 12%
旅館 × 10%
餐廳 × 8%
美容 x 14%
收容所 × 2%
這樣就得到「市內總分」。
再看跨六都表現（佔 30%）
同樣的方法，把這個行政區在「六都一起比較」下的分數，也用相同的權重加權。
這樣就得到「六都總分」。

最後合併（才會變成滿分10分,原本因為標準差的公式滿分會是9.5分
最終分 = [（市內總分 × 70%）＋（六都總分 × 30%）]× (10 / 9.5)